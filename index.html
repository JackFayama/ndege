<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aviator Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fly {
      from { transform: translateX(0); }
      to { transform: translateX(100vw); }
    }
  </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen">

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white text-black p-6 rounded-lg max-w-sm text-center">
      <p id="modalText" class="mb-4">Message</p>
      <button onclick="document.getElementById('modal').classList.add('hidden')" class="bg-blue-600 text-white px-4 py-2 rounded">OK</button>
    </div>
  </div>

  <h1 class="text-3xl font-bold mb-6">Aviator Demo Game</h1>

  <div class="mb-4 text-xl">
    Balance: <span id="balance" class="text-yellow-400 font-bold">$0.00</span>
  </div>

  <div class="relative w-full h-48 bg-gray-800 rounded-lg overflow-hidden">
    <img id="plane" src="https://i.ibb.co/BfLzKVS/aviator-plane.png"
         class="absolute w-24 left-0 top-16 transition-transform duration-75" />
    <p id="multiplier" class="absolute left-4 top-4 text-4xl font-bold text-green-400">x1.00</p>
  </div>

  <button onclick="startFlight()"
          class="mt-6 px-6 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-bold">
    Start Run
  </button>

  <audio id="flySound" src="https://actions.google.com/sounds/v1/transportation/airplane_flyby.ogg"></audio>

  <script>
    let multiplierText = document.getElementById('multiplier');
    let plane = document.getElementById('plane');
    let sound = document.getElementById('flySound');
    let balanceEl = document.getElementById('balance');

    let balance = parseFloat(localStorage.getItem('aviator_balance')) || 100;
    balanceEl.innerText = `$${balance.toFixed(2)}`;

    function updateBalanceDisplay() {
      balanceEl.innerText = `$${balance.toFixed(2)}`;
      localStorage.setItem('aviator_balance', balance.toFixed(2));
    }

    function showModal(message) {
      document.getElementById('modalText').innerText = message;
      document.getElementById('modal').classList.remove('hidden');
      document.getElementById('modal').classList.add('flex');
    }

    function startFlight() {
      let multiplier = 1.00;
      let crashed = false;
      let crashPoint = (Math.random() * 5 + 1).toFixed(2);

      const startTime = Date.now();
      localStorage.setItem('aviator_start_time', startTime);
      localStorage.setItem('aviator_crash_point', crashPoint);
      localStorage.setItem('aviator_running', 'true');

      sound.currentTime = 0;
      sound.play();
      plane.style.transition = "transform 0.1s linear";
      plane.style.transform = "translateX(0px)";
      runFlight(startTime, crashPoint);
    }

    function runFlight(startTime, crashPoint) {
      let x = 0;

      let interval = setInterval(() => {
        const elapsed = (Date.now() - startTime) / 1000;
        let multiplier = parseFloat((1 + elapsed * 0.1333).toFixed(2)); // roughly matches your original speed
        multiplierText.innerText = `x${multiplier.toFixed(2)}`;
        x += 5;
        plane.style.transform = `translateX(${x}px)`;

        if (multiplier >= crashPoint) {
          clearInterval(interval);
          sound.pause();
          sound.currentTime = 0;
          multiplierText.innerText += " ðŸ’¥ CRASHED";
          localStorage.removeItem('aviator_running');
          localStorage.removeItem('aviator_start_time');
          localStorage.removeItem('aviator_crash_point');
          showModal(`Crashed at x${multiplier.toFixed(2)}!`);
        }
      }, 75);
    }

    // Resume if flight was running
    window.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('aviator_running') === 'true') {
        const startTime = parseInt(localStorage.getItem('aviator_start_time'), 10);
        const crashPoint = parseFloat(localStorage.getItem('aviator_crash_point'));
        runFlight(startTime, crashPoint);
      }
    });
  </script>

</body>
</html>

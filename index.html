<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NovaFX - Live Forex Market</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 pt-[200px] pb-[80px] text-sm text-gray-900">

  <!-- Fixed Silent Header -->
  <div class="fixed top-0 left-0 right-0 z-50 bg-gray-100">
    <div class="p-4">
      <div class="text-2xl font-bold text-black">NovaFX</div>
    </div>
    <div class="bg-green-600 text-white mx-4 rounded-2xl p-4">
      <div class="opacity-80 text-xs">Total</div>
      <div class="text-3xl font-bold">$5,000.00</div>
      <div class="text-xs">Margin: $1,200</div>
      <div class="text-xs">Equity: $5,100</div>
      <div class="text-xs">Free Funds: $3,900</div>
    </div>
  </div>

  <!-- Market Cards -->
  <div id="markets">
    <!-- Cards inserted here -->
  </div>

  <!-- Fixed Bottom Navigation -->
  <div class="fixed bottom-0 left-0 right-0 z-50 bg-gray-100 flex justify-around py-3 rounded-t-2xl border-t">
    <button onclick="setActive(this)" class="flex flex-col items-center text-black">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
      <span>Home</span>
    </button>
    <button onclick="setActive(this)" class="flex flex-col items-center text-black">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20v-6M6 20V10M18 20V4"/></svg>
      <span>Trades</span>
    </button>
    <button onclick="setActive(this)" class="flex flex-col items-center text-black">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M7 15h0M2 9.5h20"/></svg>
      <span>Wallet</span>
    </button>
    <button onclick="setActive(this)" class="flex flex-col items-center text-black">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5.52 19c.64-2.2 1.84-3 3.22-3h6.52c1.38 0 2.58.8 3.22 3"/><circle cx="12" cy="10" r="3"/><circle cx="12" cy="12" r="10"/></svg>
      <span>User</span>
    </button>
  </div>

  <!-- WebSocket Prices -->
 <script>
  const symbols = {
    "EURUSD": "OANDA:EUR_USD",
    "GBPUSD": "OANDA:GBP_USD",
    "USDJPY": "OANDA:USD_JPY",
    "USDCHF": "OANDA:USD_CHF",
    "USDCAD": "OANDA:USD_CAD",
    "AUDUSD": "OANDA:AUD_USD",
    "NZDUSD": "OANDA:NZD_USD",
    "EURJPY": "OANDA:EUR_JPY",
    "GBPJPY": "OANDA:GBP_JPY",
    "XAUUSD": "OANDA:XAU_USD"
  };

  const socket = new WebSocket("wss://ws.finnhub.io?token=d17ug69r01qteuvq4ga0d17ug69r01qteuvq4gag");
  const prices = {};

  socket.addEventListener("open", () => {
    for (let key in symbols) {
      socket.send(JSON.stringify({ type: "subscribe", symbol: symbols[key] }));
      createMarketCard(key);
    }
  });

  socket.addEventListener("message", event => {
    const data = JSON.parse(event.data);
    if (data.type === "trade") {
      data.data.forEach(trade => {
        const full = trade.s.replace("OANDA:", "");
        const id = full.replace("_", "");
        const price = parseFloat(trade.p).toFixed(5);

        if (!prices[id]) prices[id] = { last: price };

        const sellPrice = (price - 0.0002).toFixed(5);
        const change = price - prices[id].last;
        const percent = ((change / prices[id].last) * 100).toFixed(2);
        prices[id].last = price;

        updateIfChanged(`sell-${id}`, `${sellPrice} Sell`);
        updateIfChanged(`buy-${id}`, `Buy ${price}`);
        updateIfChanged(`change-${id}`, `${change >= 0 ? "↑" : "↓"} ${Math.abs(percent)}%`, change >= 0 ? "text-green-600" : "text-red-600");
      });
    }
  });

  function updateIfChanged(id, newText, newClass = null) {
    const el = document.getElementById(id);
    if (!el) return;
    if (el.textContent !== newText) {
      el.textContent = newText;
      if (newClass) {
        el.className = `font-bold ${newClass}`;
      }
    }
  }

  function createMarketCard(id) {
    const container = document.getElementById("markets");
    const card = document.createElement("div");
    card.className = "bg-white rounded-xl shadow p-4 mx-2 mb-4 min-w-[160px]";
    card.innerHTML = `
      <div class="flex justify-between font-semibold mb-2">
        <span>${id}</span>
        <span id="change-${id}">Loading...</span>
      </div>
      <div class="flex justify-between">
        <div class="text-red-600" id="sell-${id}">Loading...</div>
        <div class="text-green-600" id="buy-${id}">Loading...</div>
      </div>
    `;
    container.appendChild(card);
  }
</script>

</body>
</html>

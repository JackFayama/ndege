<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Aviator Game</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
  <div class="flex items-center justify-between p-4 bg-gray-800">
    <div class="text-xl font-bold">Aviator Game</div>
    <div class="text-green-400 font-semibold">Balance: <span id="balance">10000.00</span> KES</div>
  </div>

  <div class="flex justify-center mt-10">
    <div class="bg-gray-800 p-6 rounded shadow-md w-full max-w-md">
      <div class="mb-4">
        <label for="betAmount" class="block text-sm mb-2">Bet Amount (KES):</label>
        <input type="number" id="betAmount" class="w-full p-2 rounded bg-gray-700 text-white" />
      </div>
      <div class="mb-4">
        <label for="autoCashout" class="block text-sm mb-2">Auto Cashout Multiplier:</label>
        <input type="number" step="0.01" id="autoCashout" class="w-full p-2 rounded bg-gray-700 text-white" />
      </div>
      <button id="placeBet" class="w-full bg-green-500 hover:bg-green-600 p-2 rounded mb-2">Place Bet</button>
      <button id="cashOut" class="w-full bg-yellow-500 hover:bg-yellow-600 p-2 rounded" disabled>Cash Out</button>
    </div>
  </div>

  <div class="flex justify-center mt-10">
    <div class="text-4xl font-bold" id="multiplier">1.00x</div>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden">
    <div class="bg-white text-black rounded-lg p-6 w-80 text-center">
      <div id="modal-message" class="mb-4 text-lg font-medium"></div>
      <button onclick="closeModal()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">OK</button>
    </div>
  </div>

  <script>
    let balance = parseFloat(localStorage.getItem("balance")) || 10000;
    let currentMultiplier = parseFloat(localStorage.getItem("multiplier")) || 1.00;
    let gameInterval;
    let inGame = false;
    let betPlaced = false;
    let cashOutMultiplier = null;

    const balanceDisplay = document.getElementById("balance");
    const multiplierDisplay = document.getElementById("multiplier");
    const betAmountInput = document.getElementById("betAmount");
    const autoCashoutInput = document.getElementById("autoCashout");
    const placeBetBtn = document.getElementById("placeBet");
    const cashOutBtn = document.getElementById("cashOut");

    const modal = document.getElementById("modal");
    const modalMsg = document.getElementById("modal-message");

    function showModal(message) {
      modalMsg.innerText = message;
      modal.classList.remove("hidden");
    }

    function closeModal() {
      modal.classList.add("hidden");
    }

    function startGameLoop() {
      gameInterval = setInterval(() => {
        currentMultiplier = parseFloat((currentMultiplier + 0.01).toFixed(2));
        multiplierDisplay.innerText = currentMultiplier.toFixed(2) + "x";
        localStorage.setItem("multiplier", currentMultiplier.toFixed(2));

        if (betPlaced && cashOutMultiplier && currentMultiplier >= cashOutMultiplier) {
          handleCashOut();
        }

        if (currentMultiplier >= 10) {
          showModal("You crashed at " + currentMultiplier.toFixed(2) + "x!");
          resetGame();
        }
      }, 100);
    }

    function resetGame() {
      clearInterval(gameInterval);
      currentMultiplier = 1.00;
      multiplierDisplay.innerText = "1.00x";
      localStorage.setItem("multiplier", "1.00");
      inGame = false;
      betPlaced = false;
      cashOutBtn.disabled = true;
    }

    function handleCashOut() {
      if (!betPlaced) return;
      const betAmount = parseFloat(betAmountInput.value);
      const winnings = parseFloat((betAmount * currentMultiplier).toFixed(2));
      balance += winnings;
      updateBalance();
      showModal(`You cashed out at ${currentMultiplier.toFixed(2)}x and won ${winnings.toFixed(2)} KES!`);
      betPlaced = false;
      cashOutBtn.disabled = true;
    }

    function updateBalance() {
      localStorage.setItem("balance", balance.toFixed(2));
      balanceDisplay.innerText = balance.toFixed(2);
    }

    placeBetBtn.addEventListener("click", () => {
      const betAmount = parseFloat(betAmountInput.value);
      if (isNaN(betAmount) || betAmount <= 0) {
        showModal("Enter a valid bet amount.");
        return;
      }
      if (balance < betAmount) {
        showModal("Insufficient balance.");
        return;
      }
      balance -= betAmount;
      updateBalance();
      betPlaced = true;
      inGame = true;
      cashOutMultiplier = parseFloat(autoCashoutInput.value) || null;
      cashOutBtn.disabled = false;

      if (!gameInterval) {
        startGameLoop();
      }
    });

    cashOutBtn.addEventListener("click", handleCashOut);

    // Initial UI state
    multiplierDisplay.innerText = currentMultiplier.toFixed(2) + "x";
    updateBalance();
    startGameLoop(); // resume even on reload
  </script>
</body>
</html>
